<include file="Public:header" />
<div class="container clearfix">
    <include file="Public:left" />
    <!--/sidebar-->
    <div class="main-wrap">

        <div class="crumb-wrap">
            <div class="crumb-list"><i class="icon-font"></i><a href="{:U('Index/index')}">首页</a><span class="crumb-step">&gt;</span><a class="crumb-name" href="{:U('Article/index')}">栏目管理</a><span class="crumb-step">&gt;</span><a class="crumb-name" href="{:U('Article/add')}">添加栏目</a></div>
        </div>

        <div class="result-wrap">
            <div class="result-content">
               <form class="layui-form" action="{:U('Category/add')}" method="post" enctype="multipart/form-data" id="addForm">
                  <div class="layui-form-item">
                    <label class="layui-form-label">上级栏目：</label>
                    <div class="layui-input-block w200" >
                      <select name="pid" lay-verify="required">
                        <option value="0">==顶级栏目==</option>
                        <volist name="categories" id="c">
                          <option value="{$c.id}">{$c.html}{$c.catname}</option>
                        </volist>
                      </select>
                    </div>
                  </div>
                  <div class="layui-form-item">
                    <label class="layui-form-label ">栏目名称：</label>
                    <div class="layui-input-block w500">
                      <input type="text" name="catname" required  lay-verify="required" placeholder="请输入标题" autocomplete="off" class="layui-input" value="">
                    </div>
                  </div>
                  <div class="layui-form-item">
                    <label class="layui-form-label ">栏目类型：</label>
                    <div class="layui-input-block">
                      <input type="radio" name="type" value="1" title="栏目" checked>
                      <input type="radio" name="type" value="2" title="单篇" >
                      <input type="radio" name="type" value="3" title="链接" >
                    </div>
                  </div>
                  <div class="layui-form-item">
                    <label class="layui-form-label">缩略图：</label>
                    <div class="layui-input-block">
                        <img src="" class="hide" id="thumb-img" height="100px" width="auto">
                        <input type="hidden" name="thumb" id="thumb-input" value="">
                        <input type="file" name="_thumb" id="_thumb" class="hide">
                        <button class="layui-btn upload-btn" onclick="_thumb.click();return false;">
                          <i class="layui-icon">&#xe608;</i> 栏目缩略图
                        </button>
                        <button id="del-thumb" class="layui-btn layui-btn-primary hide">删除</button>
                    </div>
                  </div>
                  <div class="layui-form-item">
                    <label class="layui-form-label">状态：</label>
                    <div class="layui-input-block">
                      <input type="checkbox" name="status" lay-skin="switch" checked="checked" value="1">
                    </div>
                  </div>
                  <div class="layui-form-item layui-form-text">
                    <label class="layui-form-label">描述：</label>
                    <div class="layui-input-block w500">
                      <textarea name="summary" placeholder="栏目描述..." class="layui-textarea"></textarea>
                    </div>
                  </div>
                  <div class="layui-form-item">
                    <div class="layui-inline">
                      <label class="layui-form-label">别名：</label>
                      <div class="layui-input-block">
                        <input type="tel" name="alias" autocomplete="off" class="layui-input">
                      </div>
                    </div>
                  </div>
                   <div class="layui-form-item">
                    <div class="layui-input-block">
                      <button type="submit" class="layui-btn submit" lay-submit="" >添加</button>
                      <a href="javascript:window.history.go(-1);" class="layui-btn layui-btn-warm">返回</a>
                    </div>
                  </div>
                </form>
            </div>
        </div>
    </div>
    <!--/main-->
</div>
<include file="Public:footer" />
<script type="text/javascript">
    layui.use(['form', 'layedit', 'laydate'], function(){
      var form = layui.form()
      ,layer = layui.layer
      ,layedit = layui.layedit
      ,laydate = layui.laydate;

      //栏目缩略图上传
        $('#_thumb').bind('change',function(){
          fileUpload('#_thumb','{:U("Article/upload")}');
          
        });
        function fileUpload(id,url){
            var formData = new FormData();
            formData.append("file",$(id)[0].files[0]);
            $.ajax({ 
              url : url, 
              type : 'POST', 
              data : formData, 
              processData : false, 
              contentType : false,
              beforeSend:function(){
                $('.upload-btn').html('<i class="layui-icon">&#xe608;</i>正在上传...');
              },
              success : function(msg) { 
                $('#thumb-img').attr('src',msg.src).removeClass('hide').show();
                $('#thumb-input').val(msg.src);
                $('#_thumb').val('');
                $('.upload-btn').html('<i class="layui-icon">&#xe608;</i>文章缩略图').addClass('layui-btn-disabled');
                $('#del-thumb').removeClass('hide').show();
              }, 
              error : function(responseStr) { 
                console.log("error");
                } 
            });
        }
        //删除缩略图
        $('#del-thumb').click(function(){
            $('#thumb-img').attr('src','').hide();
            $('#thumb-input').val('');
            $('#_thumb').val('');
            $(this).hide();
            $('.upload-btn').removeClass('layui-btn-disabled');
            return false;
        });
        //添加栏目
        $('.submit').on('click',function(){
          $.ajax({
            url: '{:U("Category/add")}',
            type: 'POST',
            dataType: 'json',
            data: $('#addForm').serialize(),
            success: function(res){
              if(res.status == 0){
                layer.msg(res.msg, {icon: 2});
              }else{
                layer.msg(res.msg, {icon: 1});
                window.setTimeout(function(){
                  window.location.href = "{:U('Category/index')}";
                },1500);
              }
            }
          });
          return false;
        });
    });
</script>
</body>
</html>